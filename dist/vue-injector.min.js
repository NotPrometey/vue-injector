/*!
  * @scandltd/vue-injector v1.2.0
  * (c) 2019 Scandltd
  * @license GPL-2.0
  */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.VueInjector={})}(this,function(t){"use strict";var n;function i(t,e){if(!t)throw new Error("[@scandltd/vue-injector] "+e)}var e,r,o="undefined"!=typeof window;(r=e||(e={})).DEFAULT="NEW",r.CUSTOM="FACTORY";var c=function(){function t(){}return t.prototype.getNewService=function(t){switch(t.useFactory&&"function"==typeof t.useFactory?e.CUSTOM:e.DEFAULT){case e.CUSTOM:return this.custom(t);case e.DEFAULT:default:return this.default(t)}},t.prototype.default=function(t){return new t},t.prototype.custom=function(e){var t=e.prototype.vm,r=e.import?Object.keys(e.import):[],o={};r.forEach(function(t){return o[t]=e[t]});var n=e.useFactory(t,o);if(n)return n;i(!1,"useFactory invalid return")},t}(),s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},u=function(){function t(t,e){this.rootProviders=[],this.serviceFactory=new c,this.app=t,this.rootProviders=e,this.services=new Map}return t.prototype.registerComponent=function(e){var r=this;if(e.hasOwnProperty("_providers")){var o=e._providers;o&&this.checkObject(o)?Object.keys(o).forEach(function(t){o&&o.hasOwnProperty(t)&&r.registerService(e,t,o[t])}):i(!1,"providers not object")}this.rootProviders.length&&this.rootProviders.forEach(function(t){r.checkGetName(t)&&r.registerService(e,t.getName(),t)})},t.prototype.registerService=function(t,e,r){this.services.has(r)||"Injectable"!==r.name||(r.prototype.vm=this.app,r.import&&this.registerImport(r.prototype,r.import),this.services.set(r,this.serviceFactory.getNewService(r)));var o=this.services.get(r);if(o&&r.import&&this.registerImport(o,r.import),o)return this.injectService(t,[{name:e,service:o}]),o;i(!1,"no decorator Injectable or extends Inject")},t.prototype.registerImport=function(e,r){var o=this;if(this.checkObject(r)){var t=Object.keys(r).map(function(t){return{name:t,service:o.registerService(e,t,r[t])}}).filter(function(t){return t.service instanceof f});this.injectService(e,t)}else i(!1,"providers not object")},t.prototype.set=function(t){this.checkGetName(t)&&this.registerService(this.app,t.getName(),t)},t.prototype.get=function(t){return this.services.has(t)||this.set(t),this.services.get(t)},t.prototype.injectService=function(r,t){t.forEach(function(t){var e=t.name;!Object.hasOwnProperty.call(r,e)&&t.service&&Reflect.defineProperty(r,e,{enumerable:!0,get:function(){return t.service}})})},t.prototype.checkObject=function(t){return!Array.isArray(t)&&"object"===(void 0===t?"undefined":s(t))&&null!==t},t.prototype.checkGetName=function(t){return!(!Object.hasOwnProperty.call(t,"getName")||"function"!=typeof t.getName)},t}(),p=function(t,e){return(p=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function a(r,o){var t;return void 0===o&&(o={}),(t=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.isVueService=!0,t.name=r.name,t.context=o.context||null,t.vm=t.vm,t}return function(t,e){function r(){this.constructor=t}p(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}(t,e),t.getName=function(){return r.name},t}(r)).useFactory=o.useFactory,t.import=o.import||null,t}var f=function(){function t(){}return t.getName=function(){return this.name},t}();var h=function(){function t(){for(var t=arguments,e=[],r=0;r<arguments.length;r++)e[r]=t[r];this.rootProviders=[],this.app=null,this.provider=null,this.apps=[],this.rootProviders=e}return Object.defineProperty(t.prototype,"install",{get:function(){return t.install},enumerable:!0,configurable:!0}),t.prototype.init=function(t){this.apps.push(t),this.app||(this.app=t,this.provider=new u(this.app,this.rootProviders))},t.prototype.initComponent=function(t){this.provider&&this.provider.registerComponent(t)},t.prototype.get=function(t){return this.provider&&this.provider.get(t)},t}();h.install=function t(e){if(!t.installed||n!==e){t.installed=!0;var o=function(t){return void 0!==t},r=function(t,e){var r=t.$options._parentVnode;o(r)&&o(r=r.data)&&o(r=r.registerRouteInstance)&&r(t,e)};(n=e).mixin({beforeCreate:function(){o(this.$options.providers)&&(this._providers=this.$options.providers),o(this.$options.injector)?((this._injectorRoot=this)._injector=this.$options.injector,this._injector.init(this)):(this._injectorRoot=this.$parent&&this.$parent._injectorRoot||this,this._injectorRoot._injector.initComponent(this)),r(this,this)},destroyed:function(){r(this)}}),Object.defineProperty(e.prototype,"$injector",{get:function(){return this._injectorRoot._injector}})}},h.version="1.2.0",o&&window.Vue&&window.Vue.use(h),t.Injectable=function(e){return"function"==typeof e?a(e):function(t){return a(t,e)}},t.Inject=f,t.Service=function(r){return o=function(t,e){(t.providers||(t.providers={}))[e]=r},function(t,e){var r="function"==typeof t?t:t.constructor;r.__decorators__||(r.__decorators__=[]),r.__decorators__.push(function(t){return o(t,e)})};var o},t.default=h,Object.defineProperty(t,"__esModule",{value:!0})});