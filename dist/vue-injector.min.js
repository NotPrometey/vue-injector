/*!
  * @scandltd/vue-injector v2.0.0
  * (c) 2019 Scandltd
  * @license GPL-2.0
  */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.VueInjector={})}(this,function(t){"use strict";var o;function i(t,e){if(!t)throw new Error("[@scandltd/vue-injector] "+e)}var e="undefined"!=typeof window,n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function s(t){return!Array.isArray(t)&&"object"===(void 0===t?"undefined":n(t))&&null!==t}var r,c,p=function(){function t(){this.binging=null}return t.prototype.bind=function(t,e){return Array.isArray(t)||(t=[{name:e||t.name,service:t}]),this.binging=t,this},t.prototype.to=function(r){return this.binging.forEach(function(t){var e=t.name;(!Object.hasOwnProperty.call(r,e)||!r[e])&&t.service&&Reflect.defineProperty(r,e,{enumerable:!0,get:function(){return t.service}})}),this.binging=[],!0},t}();(c=r||(r={})).NEW="NEW",c.FACTORY="FACTORY",c.VALUE="VALUE";var u={useFactory:{type:r.FACTORY,check:"function"},useValue:{type:r.VALUE}},a=function(){function t(){this.type=r.NEW}return t.prototype.make=function(t){switch(this.getType(t)){case r.FACTORY:return this.custom(t);case r.NEW:default:return this.default(t)}},t.prototype.getType=function(e){var r=this;return Object.keys(u).forEach(function(t){if(Object.hasOwnProperty.call(e,t)&&e[t]&&(r.type=u[t].type,u[t].check&&n(e[t])!==u[t].check))return i(!1,t+" invalid type: should be "+u[t].check)}),this.type},t.prototype.default=function(t){return new t},t.prototype.custom=function(t){var e=t.useFactory();if(e)return e;i(!1,"useFactory invalid return")},t}(),f=function(){function t(t,e){this.rootProviders=[],this.serviceBinding=new p,this.serviceFactory=new a,this.app=t,this.rootProviders=e,this.services=new Map}return t.prototype.registerComponent=function(e){var r=this;if(e.hasOwnProperty("_providers")){var o=e._providers;o&&s(o)?Object.keys(o).forEach(function(t){o&&o.hasOwnProperty(t)&&r.registerService(e,t,o[t])}):i(!1,"providers not object")}this.rootProviders.length&&this.rootProviders.forEach(function(t){t.isVueService&&r.registerService(e,t.name,t)})},t.prototype.registerService=function(t,e,r){if("Vue"===r.name)return t[e]=this.app;!this.services.has(r)&&r.isVueService&&(r.prototype.providers&&this.registerProviders(r.prototype,r.prototype.providers),this.services.set(r,this.serviceFactory.make(r)));var o=this.services.get(r);if(o&&r.prototype.providers&&(this.registerProviders(o,r.prototype.providers),delete r.prototype.providers),o)return this.serviceBinding.bind(o,e).to(t)&&o;i(!1,"no decorator Injectable")},t.prototype.registerProviders=function(e,r){var o=this;if(s(r)){var t=Object.keys(r).map(function(t){return{name:t,service:o.registerService(e,t,r[t])}});this.serviceBinding.bind(t).to(e)}else i(!1,"providers not object")},t.prototype.set=function(t){t.isVueService&&this.registerService(this.app,t.name,t)},t.prototype.get=function(t){return this.services.has(t)||this.set(t),this.services.get(t)},t}();function h(e,t){void 0===t&&(t={});var r=e.__decorators__;return e.prototype.name=e.name,e.isVueService=!0,e.useFactory=t.useFactory,r&&(r.forEach(function(t){return t(e.prototype)}),delete e.__decorators__),e}var v=function(){function t(t){void 0===t&&(t={}),this.rootProviders=[],this.app=null,this.provider=null,this.apps=[],this.rootProviders=t.root||[],t.store&&(t.store.$injector=this)}return Object.defineProperty(t.prototype,"install",{get:function(){return t.install},enumerable:!0,configurable:!0}),t.prototype.init=function(t){this.apps.push(t),this.app||(this.app=t,this.provider=new f(this.app,this.rootProviders))},t.prototype.initComponent=function(t){this.provider&&this.provider.registerComponent(t)},t.prototype.get=function(t){return this.provider&&this.provider.get(t)},t}();v.install=function t(e){if(!t.installed||o!==e){t.installed=!0;var r=function(t){return void 0!==t};(o=e).mixin({beforeCreate:function(){r(this.$options.providers)&&(this._providers=this.$options.providers),r(this.$options.injector)?((this._injectorRoot=this)._injector=this.$options.injector,this._injector.init(this)):(this._injectorRoot=this.$parent&&this.$parent._injectorRoot||this,this._injectorRoot._injector&&this._injectorRoot._injector.initComponent(this))}}),Object.defineProperty(e.prototype,"$injector",{get:function(){return this._injectorRoot&&this._injectorRoot._injector}}),e.config.optionMergeStrategies._injectorRoot=function(t,e){return void 0===e?t:e}}},v.version="2.0.0",e&&window.Vue&&window.Vue.use(v),t.Injectable=function(e){return"function"==typeof e?h(e):function(t){return h(t,e)}},t.Inject=function(r){return i=function(t,e){(t.providers||(t.providers={}))[e]=r},function(t,e){var r=arguments[2];r&&(delete r.initializer,r.writable=!0,r.configurable=!0);var o="function"==typeof t?t:t.constructor;o.__decorators__||(o.__decorators__=[]),o.__decorators__.push(function(t){return i(t,e)})};var i},t.default=v,Object.defineProperty(t,"__esModule",{value:!0})});